<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marina | TidePool Donor Impact Agent</title>
<style>
  :root {
    --ocean: #0a3d2e;
    --ocean-mid: #1a6b4a;
    --ocean-light: #2d9e6e;
    --foam: #e8f5ee;
    --foam-dark: #c4e8d4;
    --text: #1a2e24;
    --muted: #5a7a68;
    --white: #ffffff;
    --border: #b0d8bf;
    --radius: 14px;
    --bubble-r: 18px 18px 4px 18px;
    --bubble-l: 18px 18px 18px 4px;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #0a1f14 0%, #0d3322 50%, #0a2d4e 100%);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 16px;
  }

  .app {
    width: 100%;
    max-width: 720px;
    height: 90vh;
    max-height: 820px;
    background: var(--white);
    border-radius: 20px;
    box-shadow: 0 32px 80px rgba(0,0,0,.5);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    position: relative;
  }

  .header {
    background: linear-gradient(135deg, var(--ocean) 0%, #0d5236 100%);
    padding: 16px 20px;
    display: flex;
    align-items: center;
    gap: 14px;
    flex-shrink: 0;
  }

  .avatar {
    width: 46px;
    height: 46px;
    background: linear-gradient(135deg, var(--ocean-light) 0%, #4ecb8d 100%);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
    box-shadow: 0 0 0 3px rgba(255,255,255,.2);
  }

  .header-info h1 {
    color: var(--white);
    font-size: 17px;
    font-weight: 700;
    letter-spacing: -.2px;
  }

  .header-info .sub {
    color: #7de0aa;
    font-size: 12px;
    margin-top: 2px;
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .status-dot {
    width: 7px;
    height: 7px;
    background: #4ecb8d;
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%,100% { opacity: 1; }
    50% { opacity: .4; }
  }

  .header-badge {
    margin-left: auto;
    background: rgba(255,255,255,.12);
    color: #7de0aa;
    font-size: 10px;
    font-weight: 600;
    padding: 4px 10px;
    border-radius: 20px;
    letter-spacing: .3px;
    text-transform: uppercase;
    border: 1px solid rgba(78,203,141,.3);
  }

  .messages {
    flex: 1;
    overflow-y: auto;
    padding: 20px 16px;
    background: #f0f7f3;
    scroll-behavior: smooth;
  }

  .messages::-webkit-scrollbar { width: 5px; }
  .messages::-webkit-scrollbar-track { background: transparent; }
  .messages::-webkit-scrollbar-thumb { background: var(--foam-dark); border-radius: 10px; }

  .msg { display: flex; gap: 8px; margin-bottom: 16px; align-items: flex-end; }
  .msg.user { flex-direction: row-reverse; }

  .msg-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .msg.assistant .msg-avatar { background: linear-gradient(135deg, var(--ocean-light), #4ecb8d); }
  .msg.user .msg-avatar { background: #dce8e2; font-size: 12px; color: var(--muted); font-weight: 600; }

  .bubble {
    max-width: 78%;
    padding: 11px 15px;
    font-size: 13.5px;
    line-height: 1.6;
    color: var(--text);
  }

  .msg.assistant .bubble {
    background: var(--white);
    border-radius: var(--bubble-l);
    box-shadow: 0 1px 4px rgba(0,0,0,.08);
  }

  .msg.user .bubble {
    background: var(--ocean);
    color: var(--white);
    border-radius: var(--bubble-r);
  }

  .typing {
    display: flex;
    gap: 8px;
    align-items: flex-end;
    margin-bottom: 16px;
  }

  .typing-bubble {
    background: var(--white);
    border-radius: var(--bubble-l);
    padding: 12px 16px;
    box-shadow: 0 1px 4px rgba(0,0,0,.08);
    display: flex;
    gap: 5px;
    align-items: center;
  }

  .dot {
    width: 7px;
    height: 7px;
    background: var(--ocean-light);
    border-radius: 50%;
    animation: bounce .9s infinite;
  }
  .dot:nth-child(2) { animation-delay: .15s; }
  .dot:nth-child(3) { animation-delay: .3s; }

  @keyframes bounce {
    0%,60%,100% { transform: translateY(0); }
    30% { transform: translateY(-6px); }
  }

  .input-area {
    background: var(--white);
    border-top: 1px solid var(--border);
    padding: 14px 16px;
    flex-shrink: 0;
  }

  .input-row {
    display: flex;
    gap: 10px;
    align-items: flex-end;
  }

  .input-wrap {
    flex: 1;
    background: var(--foam);
    border: 1.5px solid var(--border);
    border-radius: 22px;
    display: flex;
    align-items: center;
    padding: 0 14px;
    transition: border-color .2s;
  }

  .input-wrap:focus-within {
    border-color: var(--ocean-light);
    box-shadow: 0 0 0 3px rgba(45,158,110,.12);
  }

  textarea {
    flex: 1;
    border: none;
    background: transparent;
    outline: none;
    font-family: inherit;
    font-size: 14px;
    color: var(--text);
    resize: none;
    padding: 11px 0;
    max-height: 100px;
    line-height: 1.4;
  }

  textarea::placeholder { color: var(--muted); }

  .send-btn {
    width: 42px;
    height: 42px;
    background: var(--ocean);
    border: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background .2s, transform .1s;
    flex-shrink: 0;
  }

  .send-btn:hover { background: var(--ocean-mid); }
  .send-btn:active { transform: scale(.93); }
  .send-btn:disabled { background: #b0c4bb; cursor: not-allowed; }
  .send-btn svg { width: 18px; height: 18px; fill: white; }

  .disclaimer {
    text-align: center;
    font-size: 10px;
    color: var(--muted);
    margin-top: 8px;
    padding: 0 8px;
  }

  .quick-prompts {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 10px;
  }

  .quick-btn {
    background: var(--foam);
    border: 1px solid var(--border);
    color: var(--ocean);
    font-size: 11.5px;
    padding: 5px 12px;
    border-radius: 20px;
    cursor: pointer;
    font-family: inherit;
    transition: all .15s;
    white-space: nowrap;
  }

  .quick-btn:hover {
    background: var(--ocean);
    color: white;
    border-color: var(--ocean);
  }

  .bubble strong { font-weight: 700; }
  .bubble em { font-style: italic; color: var(--muted); }

  .msg-time {
    font-size: 10px;
    color: #aaa;
    margin-top: 4px;
    text-align: right;
    padding: 0 4px;
  }

  .msg.assistant .msg-time { text-align: left; }
</style>
</head>
<body>

<div class="app" id="app">

  <!-- Header -->
  <div class="header">
    <div class="avatar">ğŸŒŠ</div>
    <div class="header-info">
      <h1>Marina</h1>
      <div class="sub">
        <div class="status-dot"></div>
        TidePool Donor Impact Intelligence Agent
      </div>
    </div>
    <div class="header-badge">No Key Needed Â· Live</div>
  </div>

  <!-- Messages -->
  <div class="messages" id="messages"></div>

  <!-- Input area -->
  <div class="input-area">
    <div class="quick-prompts" id="quickPrompts">
      <button class="quick-btn" onclick="sendQuick(this)">Where did my donation go?</button>
      <button class="quick-btn" onclick="sendQuick(this)">What data do you hold about me?</button>
      <button class="quick-btn" onclick="sendQuick(this)">What would â‚¬5/month achieve?</button>
      <button class="quick-btn" onclick="sendQuick(this)">Show my impact report</button>
    </div>
    <div class="input-row">
      <div class="input-wrap">
        <textarea id="userInput" rows="1" placeholder="Ask Marina about your impactâ€¦"
          onkeydown="handleKey(event)" oninput="autoResize(this)"></textarea>
      </div>
      <button class="send-btn" id="sendBtn" onclick="sendMessage()" title="Send">
        <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
      </button>
    </div>
    <div class="disclaimer">Marina is an AI-powered demo agent. Responses are informational. &nbsp;|&nbsp; <a href="https://tidepool.org/privacy" style="color:var(--ocean-light)">Privacy</a> &nbsp;|&nbsp; EX2 Assignment Demo â€” TidePool Donor Impact Intelligence</div>
  </div>

</div>

<script>
// â”€â”€â”€ TidePool Impact Database â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const DONOR = {
  first_name: "Sarah",
  donation_eur: 12,
  campaign: "Azores Deep Reef Restoration 2024",
  date: "3 February 2026",
  ref: "TP-2026-00847",
  impact_m2: 0.21,
  coral_fragments: 0.49,
  data_held: ["First name and initial","Email address","Donation amount and date","Campaign selected","Payment method type (not card number)","Country of residence"],
  legal_basis: "Legitimate interest (donation processing and impact reporting)"
};

const CAMPAIGN = {
  name: "Azores Deep Reef Restoration 2024",
  location: "Azores Archipelago, Portugal (38.7Â°N, 27.1Â°W)",
  status: "Active â€” Phase 2 of 3",
  total_raised_eur: 48750,
  total_donors: 312,
  cost_per_m2: 57.55,
  reef_m2: 847,
  coral: 2340,
  fish_species: 23,
  diver_hours: 1840,
  co2_kg: 1250,
  protected_m2: 12000,
  next_milestone: "Phase 3 coral transplantation â€” April 2026",
  last_survey: "January 2026",
  report_url: "https://tidepool.org/impact/azores-reef-2024",
  fin_conservation: 78,
  fin_research: 14,
  fin_admin: 8
};

// â”€â”€â”€ Response Library â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const RESPONSES = {

  greeting: `Hi, I'm Marina â€” TidePool's AI-powered Donor Impact Agent. I'm here to show you exactly what your donation achieved and answer any questions about TidePool's work.

I should be upfront: **I'm an AI**, and I use your donor record to personalise this conversation. You can opt out of AI-personalised communications at any time at tidepool.org/privacy.

Sarah, your â‚¬12 donation to the **Azores Deep Reef Restoration** is already making a measurable difference. Would you like to see your full impact report, find out what data I hold, or ask me anything else about TidePool's work?`,

  impact: `ğŸŒŠ **IMPACT REPORT | Azores Deep Reef Restoration 2024**
Donation: **â‚¬12** | Date: 3 Feb 2026 | Ref: TP-2026-00847
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“ **Project:** Azores Deep Reef Restoration 2024
ğŸ“Œ Location: Azores Archipelago, Portugal (38.7Â°N, 27.1Â°W)

ğŸ“Š **Your Contribution (Sarah M.):**
Your â‚¬12 â€” at a cost of â‚¬57.55 per mÂ² â€” contributed to protecting approximately **0.21 mÂ²** of Azores reef. That's roughly the size of an A4 notebook page, which is your proportional share of the **847 mÂ² restored to date** across 312 donors.

ğŸŒ¿ **Campaign Outcomes to Date** (January 2026 survey):
- ğŸª¸ Reef area restored: **847 mÂ²**
- ğŸŒ± Coral fragments planted: **2,340**
- ğŸŸ Fish species monitored: **23**
- ğŸ¤¿ Volunteer diver hours: **1,840**
- ğŸ’¨ COâ‚‚ sequestered: **1,250 kg**
- ğŸŒŠ Marine area protected: **12,000 mÂ²**

ğŸ’° **How Your Donation Was Spent:**
- 78% â†’ Direct conservation work
- 14% â†’ Research and monitoring
- 8% â†’ Operations and admin

ğŸ“… **Status:** Active â€” Phase 2 of 3
ğŸ“Œ **Next Milestone:** Phase 3 coral transplantation â€” April 2026
ğŸ“„ **Full Report:** tidepool.org/impact/azores-reef-2024

Every fraction of every donation adds up, Sarah. The 847 mÂ² restored exists because 312 people like you chose to act. Thank you.`,

  data: `ğŸ”’ **DATA TRANSPARENCY REPORT â€” Sarah M.**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ“‚ **Data TidePool Holds About You:**
- First name and initial (Sarah M.)
- Email address
- Donation amount and date (â‚¬12, 3 February 2026)
- Campaign selected (Azores Reef 2024)
- Payment method type only â€” **not** your card number
- Country of residence

âš–ï¸ **Legal Basis for Processing:**
Legitimate interest â€” donation processing and impact reporting (GDPR Article 6(1)(f))

ğŸ“‹ **Your GDPR Rights:**
- **Article 13** â€” Right to be informed: you have the right to know what data is held and why (this report fulfils that)
- **Article 15** â€” Right of access: you can request a full copy of all data held about you
- **Article 17** â€” Right to erasure: you can ask TidePool to delete your personal data at any time
- **Article 22** â€” Right to explanation: you have the right to understand how any automated decisions (including AI personalisation) are made

ğŸ¤– **AI Usage Disclosure:**
I am an AI agent. I use your donor record to personalise this conversation. No new data has been collected during this interaction. AI responses are generated automatically and are subject to human oversight.

ğŸ“© **To Exercise Your Rights:**
Email: privacy@tidepool.org | Response within 30 days under GDPR Article 12
Or visit: tidepool.org/privacy

Would you like written confirmation of any of these rights, Sarah?`,

  monthly: `Great question, Sarah. Here's what **â‚¬5/month** would achieve compared to a one-off gift:

ğŸ“Š **One-off â‚¬12 vs. Monthly â‚¬5 â€” Impact Comparison**

|   | One-off â‚¬12 | â‚¬5/month (12 months) |
|---|---|---|
| Annual contribution | â‚¬12 | **â‚¬60** |
| Reef area protected | 0.21 mÂ² | **1.04 mÂ²** |
| COâ‚‚ offset equivalent | ~2.2 kg | **~10.8 kg** |
| Coral fragments supported | ~0.5 | **~2.5** |

ğŸŒ± At â‚¬57.55/mÂ², **â‚¬5/month protects roughly 1 mÂ² of reef per year** â€” enough to sustain a complete coral micro-colony and the fish habitat it supports.

Monthly donors also unlock **Phase 3 of the Azores project** â€” the coral transplantation phase starting April 2026 â€” which requires sustained funding to proceed.

ğŸ“Œ **This is entirely optional** â€” there is no pressure or obligation. A monthly gift simply means your conservation impact compounds over time rather than being a one-off contribution.

If you'd like to set up a monthly gift, visit: tidepool.org/give/monthly

Would you like to know more about the Azores project's next phase, Sarah?`,

  financial: `ğŸ’° **How TidePool Spends Your Donation â€” Azores Reef 2024**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

Of every â‚¬1 donated to the Azores Reef campaign:

- **78p â†’ Direct conservation work** (reef surveys, coral planting, restoration dives)
- **14p â†’ Research and monitoring** (species surveys, water quality testing, biodiversity reports)
- **8p â†’ Operations and administration** (processing, communications, reporting)

For your specific â‚¬12 donation:
- **â‚¬9.36** funded direct conservation work
- **â‚¬1.68** funded research and monitoring
- **â‚¬0.96** funded operations

TidePool publishes full financial accounts annually. Verified by an independent auditor.
ğŸ“„ Full financials: tidepool.org/financials

Is there anything else you'd like to know about how funds are used, Sarah?`,

  campaign: `ğŸ“ **Azores Deep Reef Restoration 2024 â€” Campaign Overview**
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

**Location:** Azores Archipelago, Portugal (38.7Â°N, 27.1Â°W)
**Status:** Active â€” Phase 2 of 3
**Started:** March 2024

**What We're Doing:**
The Azores reef system experienced significant bleaching damage between 2021â€“2023. TidePool's programme works with local marine biologists and volunteer divers to restore reef structure through targeted coral transplantation and habitat protection.

**Current Scale (January 2026 survey):**
- 847 mÂ² of reef restored
- 2,340 coral fragments planted
- 23 fish species now monitored in the restored zone
- 1,840 volunteer diver hours logged
- 12,000 mÂ² of marine area under active protection

**Funding:**
- â‚¬48,750 raised from 312 donors
- Cost-per-mÂ² restored: â‚¬57.55
- Phase 3 (coral transplantation) begins April 2026

ğŸ“„ Full project report: tidepool.org/impact/azores-reef-2024

You're one of 312 people funding this work, Sarah. Every donor's contribution is tracked and attributed to specific outcomes.`,

  optout: `Of course, Sarah â€” I completely understand. You have every right to opt out of AI-personalised communications.

**To opt out:**
- Visit: tidepool.org/privacy
- Email: privacy@tidepool.org with the subject "Opt out of AI communications"
- Or click "Unsubscribe from personalised updates" in any TidePool email

Under **GDPR Article 17**, you can also request full erasure of your personal data. This will stop all personalised communications immediately.

Your donation and its impact remain unchanged regardless of any opt-out decision â€” you'll still receive essential donation receipts and tax documents as required by law.

Is there anything else I can help with before you go?`,

  erasure: `Understood, Sarah. Under **GDPR Article 17 (Right to Erasure)**, you have the right to request that TidePool deletes your personal data.

**How to request erasure:**
ğŸ“© Email: privacy@tidepool.org â€” Subject: "Data Erasure Request â€” [your email]"
ğŸŒ Form: tidepool.org/privacy/erasure

**What happens when you request erasure:**
- All personal data linked to your donor record will be deleted within 30 days (GDPR Article 12 deadline)
- Anonymised transaction records may be retained for legal/accounting obligations only â€” no personal identifiers attached
- You will receive written confirmation of deletion

**Note:** Erasure is irreversible. If you later wish to donate again, you would need to create a new donor record.

Would you like me to explain any of your other GDPR rights, or is there anything else I can help with?`,

  ai_disclosure: `Yes â€” I'm an AI, and I want to be completely transparent about that.

**What I am:**
I'm Marina, a rule-based AI agent built by TidePool to help donors understand exactly what their contributions achieved. I'm not a human staff member, and I'll never pretend to be.

**How I work:**
I use your donor record (Sarah M., â‚¬12 to Azores Reef 2024) to personalise responses about your impact, your data, and TidePool's work. I don't learn from this conversation or share your information with any third party.

**AI Transparency (GDPR Article 22):**
You have the right to know when AI is used in decisions that affect you. I'm AI-generated and all responses are subject to human oversight by TidePool's team.

**If you'd prefer to speak with a human:**
ğŸ“© Email: hello@tidepool.org
ğŸ“ Or request a callback via tidepool.org/contact

Is there anything specific about TidePool's AI practices you'd like to understand better?`,

  human: `Of course â€” I can connect you with TidePool's human team.

**Contact TidePool directly:**
ğŸ“© Email: hello@tidepool.org (response within 2 business days)
ğŸ“ Request a callback: tidepool.org/contact
ğŸ• Office hours: Mondayâ€“Friday, 9amâ€“5pm (GMT)

For urgent matters or formal complaints:
ğŸ“© complaints@tidepool.org (response within 5 business days, per GDPR Article 12)

I'll make a note that you requested human follow-up. Is there anything specific you'd like me to summarise for the team, Sarah?`,

  complaint: `I'm sorry to hear you're not satisfied, Sarah â€” that genuinely matters to us, and I want to make sure this is properly addressed.

**Please don't hesitate to raise this directly with TidePool's team:**
ğŸ“© complaints@tidepool.org
ğŸ• Response guaranteed within 5 business days (GDPR Article 12)

Your feedback is taken seriously. TidePool reviews all complaints and uses them to improve donor communications and practices.

If your concern is about how your data has been handled, you also have the right to escalate to your national Data Protection Authority:
ğŸ‡®ğŸ‡ª Ireland: dataprotection.ie
ğŸ‡ªğŸ‡º EU: edpb.europa.eu

I can also provide a summary of your donor record or data rights report right now if that would help. What would be most useful?`,

  thanks: `You're very welcome, Sarah â€” it's genuinely great to hear from donors who care about where their money goes.

Your â‚¬12 is part of something real. 847 mÂ² of Azores reef has been restored, and Phase 3 of the project starts in April 2026. You're a part of that.

Is there anything else I can help you with â€” about your impact, your data, or TidePool's work?`,

  goodbye: `Thank you for supporting TidePool's mission, Sarah. Your contribution to the Azores reef restoration is making a real difference â€” 0.21 mÂ² of living reef that wouldn't exist without you.

If you ever want to check in on your impact, review your data rights, or ask anything else, I'm here.

Take care. ğŸŒŠ`,

  fallback: `I want to make sure I give you accurate information, Sarah. I can help you with:

- ğŸ“Š **Your impact report** â€” exactly what your â‚¬12 achieved
- ğŸ”’ **Your data and GDPR rights** â€” what TidePool holds and how to exercise your rights
- ğŸ’° **Financial breakdown** â€” how your donation was spent
- ğŸŒ± **Monthly giving** â€” what recurring support would achieve
- ğŸ¤¿ **The Azores campaign** â€” project overview and status
- ğŸ¤– **AI transparency** â€” how this agent works
- ğŸ‘¤ **Human contact** â€” connect with TidePool's team

What would you like to know?`

};

// â”€â”€â”€ Intent Matching â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function matchIntent(text) {
  const t = text.toLowerCase().trim();

  // Greeting
  if (/^(hi|hello|hey|good morning|good afternoon|good evening|start|begin|hiya|howdy|greetings)/.test(t) && t.length < 40) {
    return 'greeting';
  }

  // Impact / donation / where did money go
  if (/\b(impact|where.{0,15}(money|donation|go)|what.{0,15}(happen|achiev|did)|show.{0,10}report|donation|achieve|reef|m2|mÂ²|how much|what did|contributed|my â‚¬|my gift)\b/.test(t)) {
    return 'impact';
  }

  // Explicit impact report request
  if (/\b(impact report|show my|my report|full report|report)\b/.test(t)) {
    return 'impact';
  }

  // Monthly / recurring giving
  if (/\b(month|recurring|regular|â‚¬5|5.{0,5}month|per month|monthly|ongoing|sustain|set up a)\b/.test(t)) {
    return 'monthly';
  }

  // Financial breakdown
  if (/\b(how.{0,10}(spent|spend|used|use)|financ|breakdown|percent|%|admin|overhead|operational|accounts|where.{0,10}money)\b/.test(t) && !/where.{0,15}(go|happen|achiev)/.test(t)) {
    return 'financial';
  }

  // GDPR erasure / deletion
  if (/\b(delete|erase|erasure|remove.{0,10}data|forget me|right to be forgotten|article 17|17)\b/.test(t)) {
    return 'erasure';
  }

  // Opt out / unsubscribe
  if (/\b(opt.?out|unsubscribe|stop email|no more|remove me|don.t contact|no contact)\b/.test(t)) {
    return 'optout';
  }

  // Data / privacy / GDPR
  if (/\b(data|privacy|gdpr|personal|what do you know|know about me|hold about|information|article 15|article 13|article 22|right to access|access request|my information)\b/.test(t)) {
    return 'data';
  }

  // Campaign / project info
  if (/\b(campaign|project|azores|reef|kelp|celtic|ocean|marine|conservation|tidepool|what.{0,15}doing|tell me about)\b/.test(t)) {
    return 'campaign';
  }

  // AI disclosure
  if (/\b(are you (an? )?(ai|bot|robot|human|real)|ai|artificial|machine|chatbot|automated|what are you|who are you)\b/.test(t)) {
    return 'ai_disclosure';
  }

  // Human / speak to staff
  if (/\b(speak to|talk to|human|person|staff|team|real person|someone real|callback|call me|contact)\b/.test(t)) {
    return 'human';
  }

  // Complaint
  if (/\b(complain|complaint|unhappy|upset|angry|not happy|disappointed|problem|issue|wrong|bad experience)\b/.test(t)) {
    return 'complaint';
  }

  // Thanks
  if (/^(thank|thanks|thank you|cheers|great|brilliant|amazing|wonderful|perfect|awesome|helpful|helpful)/.test(t) && t.length < 60) {
    return 'thanks';
  }

  // Goodbye
  if (/^(bye|goodbye|see you|take care|that.s all|done|finished|exit|quit|no more|ciao|farewell)/.test(t) && t.length < 40) {
    return 'goodbye';
  }

  return 'fallback';
}

// â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let isLoading = false;
let firstMessage = true;
const messagesEl = document.getElementById('messages');
const inputEl = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

// â”€â”€â”€ Rendering â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function now() {
  return new Date().toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
}

function renderText(text) {
  // Handle markdown table
  text = text.replace(/\|(.+)\|/g, match => {
    if (match.includes('---')) return '';
    const cells = match.split('|').filter(c => c.trim());
    const isHeader = false;
    return '<tr>' + cells.map(c => `<td style="padding:4px 10px;border:1px solid #c4e8d4;font-size:12px">${c.trim()}</td>`).join('') + '</tr>';
  });
  text = text.replace(/(<tr>.*?<\/tr>\n?)+/gs, m => `<table style="border-collapse:collapse;margin:8px 0;width:100%">${m}</table>`);

  return text
    .replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
    .replace(/^[-â€¢]\s+(.+)$/gm, '<li style="margin:2px 0 2px 16px">$1</li>')
    .replace(/(<li.*?<\/li>\n?)+/gs, m => `<ul style="padding:4px 0">${m}</ul>`)
    .replace(/\n\n/g, '<br><br>')
    .replace(/\n/g, '<br>');
}

function appendMessage(role, text) {
  const msg = document.createElement('div');
  msg.className = `msg ${role}`;

  const avatarEl = document.createElement('div');
  avatarEl.className = 'msg-avatar';
  avatarEl.textContent = role === 'assistant' ? 'ğŸŒŠ' : 'S';

  const bubbleWrap = document.createElement('div');

  const bubble = document.createElement('div');
  bubble.className = 'bubble';
  bubble.innerHTML = renderText(text);

  const time = document.createElement('div');
  time.className = 'msg-time';
  time.textContent = now();

  bubbleWrap.appendChild(bubble);
  bubbleWrap.appendChild(time);

  msg.appendChild(avatarEl);
  msg.appendChild(bubbleWrap);
  messagesEl.appendChild(msg);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function showTyping() {
  const el = document.createElement('div');
  el.className = 'typing';
  el.id = 'typing';
  el.innerHTML = `
    <div class="msg-avatar" style="width:30px;height:30px;background:linear-gradient(135deg,#2d9e6e,#4ecb8d);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px">ğŸŒŠ</div>
    <div class="typing-bubble"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div>`;
  messagesEl.appendChild(el);
  messagesEl.scrollTop = messagesEl.scrollHeight;
}

function removeTyping() {
  const el = document.getElementById('typing');
  if (el) el.remove();
}

// â”€â”€â”€ Marina response logic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getMarinaResponse(userText) {
  if (firstMessage) {
    firstMessage = false;
    return RESPONSES.greeting;
  }
  const intent = matchIntent(userText);
  return RESPONSES[intent] || RESPONSES.fallback;
}

// â”€â”€â”€ Send message â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function callMarina(userMessage) {
  if (isLoading) return;
  isLoading = true;
  sendBtn.disabled = true;

  if (userMessage !== '__greeting__') {
    appendMessage('user', userMessage);
    document.getElementById('quickPrompts').style.display = 'none';
  }

  showTyping();

  // Simulate realistic typing delay (600â€“1400ms based on response length)
  const intent = firstMessage ? 'greeting' : matchIntent(userMessage);
  const responseText = getMarinaResponse(userMessage);
  const delay = Math.min(600 + responseText.length * 1.2, 2200);

  await new Promise(r => setTimeout(r, delay));

  removeTyping();
  appendMessage('assistant', responseText);

  isLoading = false;
  sendBtn.disabled = false;
  inputEl.focus();
}

async function sendMessage() {
  const text = inputEl.value.trim();
  if (!text || isLoading) return;
  inputEl.value = '';
  autoResize(inputEl);
  await callMarina(text);
}

function sendQuick(btn) {
  if (isLoading) return;
  inputEl.value = btn.textContent;
  sendMessage();
}

function handleKey(e) {
  if (e.key === 'Enter' && !e.shiftKey) {
    e.preventDefault();
    sendMessage();
  }
}

function autoResize(el) {
  el.style.height = 'auto';
  el.style.height = Math.min(el.scrollHeight, 100) + 'px';
}

// â”€â”€â”€ Auto-start with Marina's greeting â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
window.addEventListener('load', () => {
  callMarina('__greeting__');
});
</script>
</body>
</html>
